<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">

		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/style.css" rel="stylesheet" />
		<link href="../css/mui.picker.min.css" rel="stylesheet" />
		<link href="../css/mui.poppicker.css" rel="stylesheet" />
		<style type="text/css">
			body,
			html {
				width: 100%;
				height: 100%;
				overflow: hidden;
				margin: 0;
			}
			
			#allmap {
				width: 100%;
				height: 30%;
				overflow: hidden;
				margin: 0;
			}
			
			.circle {
				border-radius: 50%;
				width: 120px;
				height: 120px;
			}
			
			h3 {
				font-weight: 500;
			}
		</style>
	</head>

	<body>
		<div id="rrapp">
			<rc-header title="考勤签到" btn="考勤统计" to="checkin_statis.html"></rc-header>
			<div class="mui-content mui-content-padded ">
				<div>
					<h2 style="font-weight: 500; padding-left: 24px;">签到<span class="font-secondary position-right">今日未签到</span></h2>
					<img src="../images/calendar.png" style="height: 24px;padding-left: 24px;"><span class="font-green">{{currentdate}}</span>

				</div>
			</div>
		</div>
		<p class="mui-content-padded"> 当前位置</p>
		<div id="allmap" class="mui-content-padded">
		</div>
		<div id="rrapp2" class="mui-content-padded">
			{{address}}
			<p v-on:click="choosepoint" style="color:#35BD66;font-size: 15px;">调整地点</p>
			<div class="dot circle background-green  aligncenter" style="text-align: center;">
				<div class="aligncenter vertical-center" style="" @click="">
					<h3 class="" style="color: #FFF;">签到</h3>
					<h3 class="" style="color: #FFF;font-size: 20px;">{{currenttime}}</h3>
				</div>

			</div>
		</div>

		<script src="../js/mui.min.js"></script>
		<script src="../js/vue.min.js"></script>
		
		<script src="../js/mui.picker.min.js"></script>
		<script src="../js/mui.poppicker.js"></script>
		<script src="../js/app.js"></script>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=GmBZ3YIRxMLsVXjG4MzoWmux9yUhdF2Z"></script>
		<script type="text/javascript" src="http://developer.baidu.com/map/jsdemo/demo/convertor.js"></script>

		<!--<script type="text/javascript" src="http://developer.baidu.com/map/jsdemo/demo/convertor.js"></script>-->

		<script type="text/javascript">
			new Vue({
				el: '#rrapp',
				data: { 
					
				},
				computed:{
					currentdate:function(){
						return new Date().toLocaleDateString();
					}
				}
				
			});
			var vm2 = new Vue({ 
				el: '#rrapp2',
				data: {
					address: '北京',
					currenttime: '15:45:58',
					points: [],//周围的点

				},
				methods: {
					choosepoint:function(){
						var picker = new mui.PopPicker();
						var data = [];
						for( i=0;i!=vm2.points.length;++i){
							
							data.push({text:vm2.points[i].title});
						}
						//alert(JSON.stringify(data));
						picker.setData(data)
						picker.show(function(rs) {
							vm2.address = rs[0].text;
							picker.dispose();
						});
					}
				}
			});
			setInterval(function() {
				var d = new Date();
				vm2.currenttime = d.toTimeString().substr(0, 8)
			}, 1000);
			mui.init();
			//initMap();
			mui.plusReady(function() {
				plus.geolocation.getCurrentPosition(translatePoint, function(e) {
					mui.toast("异常:" + e.message);
				});
			});

			function translatePoint(position) {
				var currentLon = position.coords.longitude;
				var currentLat = position.coords.latitude;
				var gpsPoint = new BMap.Point(currentLon, currentLat);
				BMap.Convertor.translate(gpsPoint, 2, initMap); //坐标转换 
				//initMap(gpsPoint)
			}

			function initMap(point) {

				var map = new BMap.Map("allmap"); // 创建Map实例
				//var point = new BMap.Point(116.404, 39.915);
				map.centerAndZoom(point, 11); // 初始化地图,设置中心点坐标和地图级别
				//map.addControl(new BMap.OverviewMapControl());
				//map.setCurrentCity("北京"); // 设置地图显示的城市 此项是必须设置的
				map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放
				/*map.enableDragging();*/
				map.disableDragging();
				map.centerAndZoom(point, 15);
				//var myIcon = new BMap.Icon("../images/position.png", new BMap.Size(70,50));
				var marker = new BMap.Marker(point); // 创建标注    

				map.addOverlay(marker); // 将标注添加到地图中
				//marker.enableDragging();
				map.addEventListener('dragend', function() {
					marker.setPosition(map.getCenter());
				});
				marker.setAnimation(BMAP_ANIMATION_BOUNCE);

				var geoc = new BMap.Geocoder();				
				var mOption = {
					poiRadius: 1000, //半径为r米内的POI,  
					numPois: 10 //最多只有12个 系统决定的   
				} 
				geoc.getLocation(point, function(rs) {
					var address = rs.address;
					var points = rs.surroundingPois;
					vm2.address = address;
					if(points.length>0){
						vm2.points = points;
					}			
					
					//alert(JSON.stringify(points));
					

				},mOption);
			}
		</script>
	</body>

</html>